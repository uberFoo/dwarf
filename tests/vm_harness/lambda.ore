fn runner(func: fn(string, int) -> float) {
    chacha::assert_eq(3.14, func("foo", 77));
}

fn main() {
    let answer = 42;

    let foo = |bar: int| -> int {
        // this comment is to trick the formatter
        bar
    };
    chacha::assert_eq(foo(answer), answer);

    let bar = || -> int { foo(answer) as int };
    chacha::assert_eq(bar(), answer);

    let baz = |name: string| -> string { "hello, ${name}! The answer is ${answer}" };
    chacha::assert_eq(baz("world"), "hello, world! The answer is 42");

    runner(|s: string, i: int| -> float {
        chacha::assert_eq(s, "foo");
        chacha::assert_eq(i, 77);

        chacha::assert_eq(answer, 42);

        // This should be captured.
        answer = 69;
        3.14
    });

    chacha::assert_eq(answer, 69);
}
